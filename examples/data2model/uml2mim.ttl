@prefix localupdatestage: <http://localhost:8080/data2model/update/>.
@prefix updatestage: <http://linkeddata.ordina.nl/data2model/update/>.
@prefix stage: <http://localhost:8080/data2model/stage#>.
@prefix elmo: <http://bp4mc2.org/elmo/def#>.
@prefix html: <http://www.w3.org/1999/xhtml/vocab#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.

#Production for local installations
localupdatestage:uml2mim a elmo:Production;
  elmo:contains stage:HeaderAppearance;
  elmo:contains stage:Menu;
  elmo:contains stage:uml2mim_scene000;
  elmo:contains stage:uml2mim_scene001;
  elmo:contains stage:uml2mim_scene002;
  elmo:contains stage:uml2mim_scene003;
  elmo:contains stage:uml2mim_scene099;
  elmo:contains stage:uml2mim_scene100;
  elmo:contains stage:uml2mim_scene101;
.

stage:uml2mim_scene000 a elmo:Scene;
  elmo:index "000";
  rdfs:label "Clear target graph";
  elmo:query "CLEAR GRAPH <http://localhost:8080/data2model/container/mim>";
.

stage:uml2mim_scene001 a elmo:Scene;
  elmo:index "001";
  rdfs:label "Add mim:Objecttype";
  elmo:query '''
    PREFIX uml: <http://schema.omg.org/spec/UML/2.1.1#>
    PREFIX ea: <http://www.sparxsystems.com/extender/EA6.5#>
    PREFIX mim: <http://bp4mc2.org/def/mim#>
    PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
    INSERT {
      GRAPH <http://localhost:8080/data2model/container/mim> {
        ?objecttype a mim:Objecttype.
        ?objecttype rdfs:seeAlso ?class.
      }
    }
    WHERE {
      GRAPH <http://localhost:8080/data2model/container/xmidata> {
        SELECT ?class as ?objecttype ?class
        WHERE {
          ?class a uml:Class.
          ?class ea:stereotype "Objecttype"^^xsd:string.
        }
      }
    }
  '''
.

stage:uml2mim_scene002 a elmo:Scene;
  elmo:index "002";
  rdfs:label "Add mim:Attribuutsoort";
  elmo:query '''
  PREFIX uml: <http://schema.omg.org/spec/UML/2.1.1#>
  PREFIX ea: <http://www.sparxsystems.com/extender/EA6.5#>
  PREFIX mim: <http://bp4mc2.org/def/mim#>
  PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
  INSERT {
    GRAPH <http://localhost:8080/data2model/container/mim> {
      ?objecttype mim:attribuut ?attribuutsoort.
      ?attribuutsoort a mim:Attribuutsoort.
      ?attribuutsoort rdfs:seeAlso ?property.
    }
  }
  WHERE {
    GRAPH <http://localhost:8080/data2model/container/mim> {
      ?objecttype a mim:Objecttype.
      ?objecttype rdfs:seeAlso ?class
    }
    GRAPH <http://localhost:8080/data2model/container/xmidata> {
      select (?property as ?attribuutsoort) ?class ?property
      where {
        ?class a uml:Class.
        ?class ea:stereotype "Objecttype"^^xsd:string.
        ?class uml:ownedAttribute ?property.
        ?property a uml:Property.
        FILTER NOT EXISTS {
          ?association uml:memberEnd ?property
        }
      }
    }
  }
  '''
.

stage:uml2mim_scene003 a elmo:Scene;
  elmo:index "003";
  rdfs:label "Add Relatiesoort";
  elmo:query '''
    PREFIX uml: <http://schema.omg.org/spec/UML/2.1.1#>
    PREFIX ea: <http://www.sparxsystems.com/extender/EA6.5#>
    PREFIX mim: <http://bp4mc2.org/def/mim#>
    PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
    INSERT {
      GRAPH <http://localhost:8080/data2model/container/mim> {
        ?relatiesoort a mim:Relatiesoort.
        ?relatiesoort rdfs:seeAlso ?association.
        ?relatiesoort mim:bron ?bron.
        ?relatiesoort mim:doel ?doel.
      }
    }
    WHERE {
      GRAPH <http://localhost:8080/data2model/container/mim> {
        ?bron a mim:Objecttype.
        ?bron rdfs:seeAlso ?source.
        ?doel a mim:Objecttype.
        ?doel rdfs:seeAlso ?target.
      }
      GRAPH <http://localhost:8080/data2model/container/xmidata> {
        select (?association as ?relatiesoort) ?association ?source ?target
        where {
          ?association a uml:Association.
          ?association ea:stereotype "Relatiesoort"^^xsd:string.
          ?association uml:ownedEnd ?ownedend.
          ?association uml:memberEnd ?memberend.
          FILTER (?ownedend != ?memberend).
          ?ownedend uml:type ?source.
          ?memberend uml:type ?target.
        }
      }
    }
  ''';
.

stage:uml2mim_scene099 a elmo:Scene;
  elmo:index "099";
  rdfs:label "Add mim:Generalisatie";
  elmo:query '''
    PREFIX uml: <http://schema.omg.org/spec/UML/2.1.1#>
    PREFIX ea: <http://www.sparxsystems.com/extender/EA6.5#>
    PREFIX mim: <http://bp4mc2.org/def/mim#>
    PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
    INSERT {
      GRAPH <http://localhost:8080/data2model/container/mim> {
        ?generalisatie a mim:Generalisatie.
        ?generalisatie mim:subtype ?subtype.
        ?generalisatie mim:supertype ?supertype.
        ?generalisatie rdfs:seeAlso ?generalization.
      }
    }
    WHERE {
      GRAPH <http://localhost:8080/data2model/container/xmidata> {
        SELECT (?generalization as ?generalisatie) ?generalization ?class ?general
        WHERE {
          ?class uml:generalization ?generalization.
          ?generalization uml:general ?general
        }
      }
      GRAPH <http://localhost:8080/data2model/container/mim> {
        ?subtype rdfs:seeAlso ?class.
        ?supertype rdfs:seeAlso ?general.
      }
    }
  '''
.

stage:uml2mim_scene100 a elmo:Scene;
  elmo:index "100";
  rdfs:label "Add default datatypes";
  elmo:query '''
    PREFIX mim: <http://bp4mc2.org/def/mim#>
    PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
    INSERT {
      GRAPH <http://localhost:8080/data2model/container/mim> {
        mim:CharacterString rdfs:seeAlso xsd:string.
        mim:Integer rdfs:seeAlso xsd:integer.
        mim:Real rdfs:seeAlso xsd:decimal.
        mim:Boolean rdfs:seeAlso xsd:boolean.
        mim:Date rdfs:seeAlso xsd:date.
        mim:DateTime rdfs:seeAlso xsd:dateTime.
        mim:Year rdfs:seeAlso xsd:gYear.
        mim:Day rdfs:seeAlso xsd:gDay.
        mim:Month rdfs:seeAlso xsd:gMonth.
        mim:URI rdfs:seeAlso xsd:AnyURI.
      }
    }
    WHERE {}
  ''';
.

stage:uml2mim_scene101 a elmo:Scene;
  elmo:index "101";
  rdfs:label "Add mim:name";
  elmo:query '''
    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
    PREFIX owl: <http://www.w3.org/2002/07/owl#>
    PREFIX sh: <http://www.w3.org/ns/shacl#>
    PREFIX mim: <http://bp4mc2.org/def/mim#>
    INSERT {
      GRAPH <http://localhost:8080/data2model/container/mim> {
        ?element mim:naam ?naam
      }
    }
    WHERE {
      GRAPH <http://localhost:8080/data2model/container/mim> {
        ?element rdfs:seeAlso ?item
      }
      GRAPH <http://localhost:8080/data2model/container/xmidata> {
        ?item rdfs:label ?naam
      }
    }
  ''';
.
